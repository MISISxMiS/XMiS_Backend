<h1>XMiS_Backend</h1>

<h2>๐บ๏ธ Place Recommendation API</h2>
<p>ะกะตัะฒะธั ัะตะบะพะผะตะฝะดะฐัะธะน ะผะตัั ะฝะฐ ะพัะฝะพะฒะต ัะตะบััะพะฒัั ะทะฐะฟัะพัะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ AI. ะกะธััะตะผะฐ ะฐะฝะฐะปะธะทะธััะตั ะฟะพะถะตะปะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ัะตะบะพะผะตะฝะดัะตั ะฟะพะดัะพะดััะธะต ะทะฐะฒะตะดะตะฝะธั, ัะปะธัั ะธ ะดะพััะพะฟัะธะผะตัะฐัะตะปัะฝะพััะธ.</p>

<h2>๐ ะัะฝะพะฒะฝัะต ััะฝะบัะธะธ</h2>
<ul>
  <li>ะฃะผะฝัะน ะฟะพะธัะบ โ ัะตะบะพะผะตะฝะดะฐัะธะธ ะผะตัั ะฝะฐ ะพัะฝะพะฒะต ัะตะบััะพะฒะพะณะพ ะพะฟะธัะฐะฝะธั</li>
  <li>AI-ะฐะฝะฐะปะธะท โ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต ะบะฐัะตะณะพัะธะน ะธ ัะตะณะพะฒ ะธะท ะพัะทัะฒะพะฒ</li>
  <li>ะะฑัััะฝะตะฝะธั โ ะฟะพะฝััะฝัะต ะฟะพััะฝะตะฝะธั, ะฟะพัะตะผั ะผะตััะพ ะฟะพะดัะพะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั</li>
  <li>ะะพะฑะฐะฒะปะตะฝะธะต ะผะตัั โ ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั ะดะพะฑะฐะฒะปััั ะธ ะพะฑะฝะพะฒะปััั ะผะตััะฐ ัะตัะตะท ะพัะทัะฒั</li>
  <li>ะัะปััะธะผะตะดะธะฐ โ ะฟะพะดะดะตัะถะบะฐ ัะพัะพะณัะฐัะธะน ะทะฐะฒะตะดะตะฝะธะน</li>
</ul>

<h2>๐๏ธ ะััะธัะตะบัััะฐ</h2>
<pre>
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
โ   FastAPI       โ    โ   PostgreSQL     โ    โ   LLM        โ
โ   Backend       โโโโโบโ   Database       โโโโโบโ   (OpenRouter)โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
         โ                       โ
         โ                       โ
         โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
โ   Static Files  โ    โ   Docker         โ
โ   (Photos)      โ    โ   Containers     โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
</pre>

<h3>ะขะตัะฝะพะปะพะณะธะธ</h3>
<ul>
  <li><b>Backend:</b> FastAPI, SQLAlchemy, asyncpg</li>
  <li><b>AI:</b> OpenAI GPT-4o ัะตัะตะท OpenRouter</li>
  <li><b>ะะฐะทะฐ ะดะฐะฝะฝัั:</b> PostgreSQL</li>
  <li><b>ะะพะฝัะตะนะฝะตัะธะทะฐัะธั:</b> Docker, Docker Compose</li>
  <li><b>ะฅัะฐะฝะธะปะธัะต:</b> ะะพะบะฐะปัะฝะฐั ัะฐะนะปะพะฒะฐั ัะธััะตะผะฐ ะดะปั ัะพัะพ</li>
</ul>

<h2>๐ก ะญะฝะดะฟะพะธะฝัั API</h2>
<ul>
  <li><b>๐ ะะตะบะพะผะตะฝะดะฐัะธะธ</b>
    <ul>
      <li>POST /recommendations โ ะฟะพะปััะธัั ัะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะตะบััะพะฒะพะผั ะทะฐะฟัะพัั</li>
      <li>POST /explain โ ะพะฑัััะฝะธัั, ะฟะพัะตะผั ะผะตััะพ ะฟะพะดัะพะดะธั ะฟะพะด ะทะฐะฟัะพั</li>
    </ul>
  </li>
  <li><b>๐ ะัะทัะฒั ะธ ะผะตััะฐ</b>
    <ul>
      <li>POST /review โ ะดะพะฑะฐะฒะธัั ะพัะทัะฒ ะพ ะผะตััะต (ั ัะพัะพ)</li>
      <li>GET /review-guide โ ะฟะพะปััะธัั ะฟะพะดัะบะฐะทะบั ะฟะพ ะฝะฐะฟะธัะฐะฝะธั ะพัะทัะฒะฐ</li>
      <li>POST /places โ ะดะพะฑะฐะฒะธัั ะพะดะฝะพ ะผะตััะพ</li>
      <li>POST /places/batch โ ะดะพะฑะฐะฒะธัั ะฝะตัะบะพะปัะบะพ ะผะตัั</li>
    </ul>
  </li>
  <li><b>๐ผ๏ธ ะะตะดะธะฐ</b>
    <ul>
      <li>GET /static/photos/{filename} โ ะฟะพะปััะธัั ัะพัะพ ะผะตััะฐ</li>
    </ul>
  </li>
</ul>

<h2>๐ ะัััััะน ะทะฐะฟััะบ</h2>
<h3>ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั</h3>
<ul>
  <li>Docker</li>
  <li>Docker Compose</li>
  <li>API ะบะปัั OpenRouter</li>
</ul>

<ol>
  <li>
    <b>ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ะฝะฐัััะพะนะบะฐ</b>
    <pre><code>git clone &lt;repository-url&gt;
cd &lt;project-directory&gt;</code></pre>
  </li>
  <li>
    <b>ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั</b>
    <pre><code>cp .env.example .env</code></pre>
    <p>ะะฐะฟะพะปะฝะธัะต ะฝะฐัััะพะนะบะธ ะฒ <code>.env</code>:</p>
    <ul>
      <li>OPENROUTER_API_KEY=ะฒะฐั_ะบะปัั</li>
      <li>DB_NAME=places_db</li>
      <li>DB_USER=user</li>
      <li>DB_PASS=password</li>
    </ul>
  </li>
  <li>
    <b>ะะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั</b>
    <pre><code>mkdir -p static/photos initdb
# ะะพะปะพะถะธัะต ะดะฐะผะฟ ะฑะฐะทั ะดะฐะฝะฝัั (ะตัะปะธ ะตััั)
# cp ะฒะฐั_ะดะฐะผ.sql initdb/backup.sql
# ะะพะปะพะถะธัะต ัะพัะพ ะฒ static/photos/ (ะตัะปะธ ะตััั)
</code></pre>
  </li>
  <li>
    <b>ะะฐะฟััะบ</b>
    <pre><code># ะะฐะทัะฐะฑะพัะบะฐ
docker-compose -f docker-compose.dev.yaml up --build

# ะัะพะดะฐะบัะฝ
docker-compose -f docker-compose.prod.yaml up --build
</code></pre>
  </li>
  <li>
    <b>ะัะพะฒะตัะบะฐ</b>
    <p>ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต: <a href="http://localhost:8000/docs">http://localhost:8000/docs</a></p>
  </li>
</ol>

<h3>๐ก ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั</h3>
<p><b>ะะพะปััะธัั ัะตะบะพะผะตะฝะดะฐัะธะธ</b></p>
<pre><code>curl -X POST "http://localhost:8000/recommendations" \
  -H "Content-Type: application/json" \
  -d '{
    "user_prompt": "ะัั ัะธัะพะต ะบะฐัะต ั Wi-Fi ะดะปั ัะฐะฑะพัั",
    "limit": 5
  }'
</code></pre>
<p><b>ะะพะฑะฐะฒะธัั ะพัะทัะฒ ั ัะพัะพ</b></p>
<pre><code>curl -X POST "http://localhost:8000/review" \
  -H "Content-Type: multipart/form-data" \
  -F "url=https://2gis.ru/cozy_coffee" \
  -F "place_title=ะะพัะตะนะฝั ะฃัั" \
  -F "review_text=ะขะธัะพะต ะบะฐัะต ั ัะดะพะฑะฝัะผะธ ััะพะปะธะบะฐะผะธ ะธ ัะพะทะตัะบะฐะผะธ" \
  -F "photo=@photo.jpg"
</code></pre>
<p><b>ะะพะปััะธัั ัะพัะพ</b></p>
<pre><code>curl "http://localhost:8000/static/photos/photo.jpg" --output photo.jpg
</code></pre>

<h2>๐ท๏ธ ะกะธััะตะผะฐ ะบะฐัะตะณะพัะธะน</h2>
<p>ะกะตัะฒะธั ะธัะฟะพะปัะทัะตั 6 ะพัะฝะพะฒะฝัั ะบะฐัะตะณะพัะธะน ะดะปั ะบะปะฐััะธัะธะบะฐัะธะธ ะผะตัั:</p>
<ul>
  <li><b>ะขะธะฟั ะผะตัั (entity_types)</b> โ ัะตััะพัะฐะฝ, ะบะฐัะต, ะฑะฐั, ะฟะฐัะบ, ะผัะทะตะน ะธ ั.ะด.</li>
  <li><b>ะัะผะพััะตัะฐ (atmosphere_tags)</b> โ ัััะฝัะน, ัะพะผะฐะฝัะธัะฝัะน, ัะธัะธะน, ััะผะฝัะน ะธ ั.ะด.</li>
  <li><b>ะฆะตะปะธ ะฟะพัะตัะตะฝะธั (purpose_tags)</b> โ ัะฐะฑะพัะฐ, ัะฒะธะดะฐะฝะธะต, ะฒัััะตัะธ, ะฟัะพะณัะปะบะธ ะธ ั.ะด.</li>
  <li><b>ะัะดะถะตั (budget_level)</b> โ ะฑัะดะถะตัะฝัะน, ััะตะดะฝะธะน, ะดะพัะพะณะพะน</li>
  <li><b>ะัะพะฑะตะฝะฝะพััะธ (features)</b> โ Wi-Fi, ะถะธะฒะฐั ะผัะทัะบะฐ, ะฟะฐัะบะพะฒะบะฐ ะธ ั.ะด.</li>
  <li><b>ะัะตะผั ะฟะพัะตัะตะฝะธั (best_time)</b> โ ัััะพ, ะดะตะฝั, ะฒะตัะตั, ะฝะพัั</li>
</ul>

<h2>๐ง ะะฐะทัะฐะฑะพัะบะฐ</h2>
<h3>ะกัััะบัััะฐ ะฟัะพะตะบัะฐ</h3>
<pre>
โโโ api/                    # ะััะพะดะฝัะน ะบะพะด
โ   โโโ main.py            # FastAPI ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ agent.py           # LLM ะฐะณะตะฝั ะดะปั ะฐะฝะฐะปะธะทะฐ
โ   โโโ crud.py            # ะะฟะตัะฐัะธะธ ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
โ   โโโ database.py        # ะะฐัััะพะนะบะธ ะะ
โ   โโโ models.py          # SQLAlchemy ะผะพะดะตะปะธ
โ   โโโ config.py          # ะะพะฝัะธะณััะฐัะธั
โโโ static/photos/         # ะคะพัะพะณัะฐัะธะธ ะผะตัั
โโโ initdb/               # ะกะบัะธะฟัั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะะ
โโโ docker-compose.dev.yaml
โโโ docker-compose.prod.yaml
โโโ pyproject.toml
|__ .env
</pre>

<h3>ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ</h3>
<p>ะะพะบัะผะตะฝัะฐัะธั API: <code>GET /docs</code> (Swagger)</p>
<p><b>ะัะธะผะตัะฐะฝะธะต:</b> ะะปั ัะฐะฑะพัั ัะตัะฒะธัะฐ ะฝะตะพะฑัะพะดะธะผ API ะบะปัั OpenRouter. ะะพะปััะธัะต ะตะณะพ ะฝะฐ <a href="https://openrouter.ai" target="_blank">openrouter.ai</a></p>